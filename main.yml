- hosts:
    - server
    - pi

  tasks:
    - name: make sure ntp is installed
      become: yes
      ansible.builtin.apt:
        name: ntp
        state: latest

    - name: make sure ntp service is started
      become: yes
      ansible.builtin.service:
        name: ntp
        state: started
        enabled: yes

    - name: set timezone
      become: yes
      community.general.timezone:
        name: Asia/Shanghai

    - name: update using apt
      become: yes
      ansible.builtin.apt:
        autoclean: yes
        autoremove: yes
        upgrade: "full"

    - name: install packages
      become: yes
      ansible.builtin.package:
        name:
          - docker.io
          - docker-compose
          - vim
          - neovim
          - tmux
          - zsh
          - fish
          - nodejs
          - yarnpkg
          # 可以通过 $hostname.local 访问本地设备
          - avahi-daemon
        state: latest

    - name: start docker service
      become: yes
      ansible.builtin.service:
        name: docker
        state: started
        enabled: yes

    - name: copy service files
      copy:
        src: "{{ playbook_dir }}/stuff/services"
        dest: "~"

    - name: start netdata service with docker-compose
      become: yes
      community.docker.docker_compose:
        project_src: "/home/{{ ansible_user }}/services/netdata"
        state: present
        pull: yes
